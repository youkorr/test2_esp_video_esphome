/*
 * SPDX-FileCopyrightText: 2024-2025 Espressif Systems (Shanghai) CO LTD
 *
 * SPDX-License-Identifier: ESPRESSIF MIT
 */

#include "esp_ipa_types.h"

/**
 * @brief Stub implementation of IPA detection array symbols
 *
 * In ESP-IDF, these symbols are generated by linker fragments (.lf files).
 * For PlatformIO/ESPHome, we provide them manually.
 *
 * The IPA pipeline code iterates: for (p = &start; p < &end; ++p)
 * Therefore we MUST create a contiguous array in memory.
 *
 * Available IPAs in libesp_ipa.a:
 * - AWB: Auto White Balance (Gray World)
 * - AGC: Auto Gain Control (Threshold)
 * - Denoising: Gain feedback
 * - Sharpen: Frequency feedback
 * - Gamma: Luminance feedback
 * - CC: Color Correction (Linear)
 */

// Forward declarations from libesp_ipa.a
extern esp_ipa_t *__esp_ipa_detect_fn_awb_gray_world(void *config);
extern esp_ipa_t *__esp_ipa_detect_fn_agc_threshold(void *config);
extern esp_ipa_t *__esp_ipa_detect_fn_denoising_gain_feedback(void *config);
extern esp_ipa_t *__esp_ipa_detect_fn_sharpen_freq_feedback(void *config);
extern esp_ipa_t *__esp_ipa_detect_fn_gamma_lumma_feedback(void *config);
extern esp_ipa_t *__esp_ipa_detect_fn_cc_linear(void *config);

// Define the structure type used for detection
typedef struct esp_ipa_detect {
    const char *name;
    esp_ipa_t *(*detect)(void *);
} esp_ipa_detect_t;

/**
 * IPA detection array - MUST be contiguous in memory!
 *
 * We create a real array and expose pointers to first and last+1 elements
 * as the __esp_ipa_detect_array_start and __esp_ipa_detect_array_end symbols.
 */
static esp_ipa_detect_t s_esp_ipa_detect_array[] = {
    {
        .name = "awb_gray_world",
        .detect = __esp_ipa_detect_fn_awb_gray_world,
    },
    {
        .name = "agc_threshold",
        .detect = __esp_ipa_detect_fn_agc_threshold,
    },
    {
        .name = "denoising_gain_feedback",
        .detect = __esp_ipa_detect_fn_denoising_gain_feedback,
    },
    {
        .name = "sharpen_freq_feedback",
        .detect = __esp_ipa_detect_fn_sharpen_freq_feedback,
    },
    {
        .name = "gamma_lumma_feedback",
        .detect = __esp_ipa_detect_fn_gamma_lumma_feedback,
    },
    {
        .name = "cc_linear",
        .detect = __esp_ipa_detect_fn_cc_linear,
    },
};

/**
 * Export the array boundaries as the symbols expected by libesp_ipa.a
 *
 * The library code does: for (p = &start; p < &end; ++p)
 * So we need start to point to first element and end to point to one past last.
 */
esp_ipa_detect_t *__esp_ipa_detect_array_start = &s_esp_ipa_detect_array[0];
esp_ipa_detect_t *__esp_ipa_detect_array_end = &s_esp_ipa_detect_array[6];
