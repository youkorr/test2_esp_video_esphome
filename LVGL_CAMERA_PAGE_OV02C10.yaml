# Page LVGL simplifi√©e pour cam√©ra OV02C10
# R√©solution: 800x480 (plein √©cran)
# Contr√¥les: BACK, START, STOP, INFO

lvgl:
  pages:
    - id: camera_page
      bg_color: 0x000000  # Fond noir

      on_load:
        - lambda: |-
            ESP_LOGI("camera", "üì∏ Page cam√©ra OV02C10 charg√©e");
            ESP_LOGI("camera", "Canvas: 800x480 plein √©cran");

            // Optionnel: d√©marrer automatiquement le streaming
            // D√©commentez les lignes ci-dessous pour auto-start:
            // if (id(tab5_cam).start_streaming()) {
            //   lv_label_set_text(id(camera_status_label), "LIVE");
            //   lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0x00FF00), 0);
            // }

      widgets:
        # ============================================
        # CANVAS CAM√âRA - PLEIN √âCRAN
        # ============================================
        - canvas:
            id: camera_canvas
            width: 800
            height: 480
            x: 0
            y: 0
            bg_color: 0x000000

        # ============================================
        # BOUTONS DE CONTR√îLE - EN HAUT √Ä DROITE
        # ============================================

        # Bouton RETOUR
        - button:
            id: btn_camera_back
            width: 100
            height: 45
            x: 680
            y: 10
            bg_color: 0x333333
            radius: 8
            on_click:
              then:
                - lambda: |-
                    ESP_LOGI("camera", "üîô Arr√™t du streaming et retour");
                    id(tab5_cam).stop_streaming();
                - lvgl.page.show: page_home
            widgets:
              - label:
                  text: "BACK"
                  text_color: 0xFFFFFF
                  text_font: nunito_20
                  text_align: CENTER

        # Bouton START
        - button:
            id: btn_start_streaming
            width: 100
            height: 45
            x: 680
            y: 65
            bg_color: 0x00AA00  # Vert
            radius: 8
            on_click:
              then:
                - lambda: |-
                    ESP_LOGI("camera", "‚ñ∂Ô∏è  D√©marrage du streaming");
                    if (id(tab5_cam).start_streaming()) {
                      lv_label_set_text(id(camera_status_label), "LIVE");
                      lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0x00FF00), 0);
                    } else {
                      lv_label_set_text(id(camera_status_label), "ERROR");
                      lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0xFF0000), 0);
                    }
            widgets:
              - label:
                  text: "START"
                  text_color: 0xFFFFFF
                  text_font: nunito_20
                  text_align: CENTER

        # Bouton STOP
        - button:
            id: btn_stop_streaming
            width: 100
            height: 45
            x: 680
            y: 120
            bg_color: 0xCC0000  # Rouge
            radius: 8
            on_click:
              then:
                - lambda: |-
                    ESP_LOGI("camera", "‚èπÔ∏è  Arr√™t du streaming");
                    id(tab5_cam).stop_streaming();
                    lv_label_set_text(id(camera_status_label), "STOPPED");
                    lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0xFF8800), 0);
            widgets:
              - label:
                  text: "STOP"
                  text_color: 0xFFFFFF
                  text_font: nunito_20
                  text_align: CENTER

        # Bouton INFO
        - button:
            id: btn_camera_info
            width: 100
            height: 45
            x: 680
            y: 175
            bg_color: 0x4682B4  # Bleu
            radius: 8
            on_click:
              then:
                - lambda: |-
                    ESP_LOGI("camera", "üìä === INFORMATIONS CAM√âRA ===");
                    ESP_LOGI("camera", "Sensor: OV02C10");
                    ESP_LOGI("camera", "R√©solution configur√©e: 800x480");

                    // R√©solution runtime (seulement si streaming actif)
                    int w = id(tab5_cam).get_image_width();
                    int h = id(tab5_cam).get_image_height();
                    if (w > 0 && h > 0) {
                      ESP_LOGI("camera", "R√©solution runtime: %dx%d", w, h);
                      ESP_LOGI("camera", "Streaming: ACTIF");
                    } else {
                      ESP_LOGI("camera", "Streaming: ARR√äT√â");
                    }

                    ESP_LOGI("camera", "Format: RGB565");
                    ESP_LOGI("camera", "Canvas: 800x480 plein √©cran");
                    ESP_LOGI("camera", "Bayer: BGGR");
                    ESP_LOGI("camera", "MIPI: 2-lane");
                    ESP_LOGI("camera", "Adresse I2C: 0x36");

                    lv_label_set_text(id(camera_status_label), "INFO");
                    lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0x4682B4), 0);
                - delay: 2s
                - lambda: |-
                    if (id(tab5_cam).is_streaming()) {
                      lv_label_set_text(id(camera_status_label), "LIVE");
                      lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0x00FF00), 0);
                    } else {
                      lv_label_set_text(id(camera_status_label), "READY");
                      lv_obj_set_style_text_color(id(camera_status_label), lv_color_hex(0xFF8800), 0);
                    }
            widgets:
              - label:
                  text: "INFO"
                  text_color: 0xFFFFFF
                  text_font: nunito_20
                  text_align: CENTER

        # ============================================
        # LABEL DE STATUS - EN BAS √Ä DROITE
        # ============================================
        - label:
            id: camera_status_label
            text: "READY"
            x: 730
            y: 450
            text_color: 0xFF8800
            text_font: nunito_24
            text_align: CENTER

# ============================================
# CONFIGURATION CAM√âRA ASSOCI√âE
# ============================================
# √Ä mettre dans votre configuration principale:

# NOTE: Les noms de bus I2C sont configurables
# Remplacez 'bsp_bus' par le nom de votre bus I2C

# mipi_dsi_cam:
#   id: tab5_cam
#   i2c_id: bsp_bus            # ‚Üê CHANGEZ selon votre configuration I2C
#   sensor_type: ov02c10
#   sensor_addr: 0x36          # OV02C10, OV5647, SC202CS = tous 0x36
#   resolution: "800x480"      # Custom format
#   pixel_format: RGB565
#   framerate: 30

# lvgl_camera_display:
#   id: camera_display
#   camera_id: tab5_cam
#   canvas_id: camera_canvas
#   update_interval: 100ms     # 10 FPS (√©vite watchdog timeout)

# display:
#   - platform: ili9xxx
#     model: st7796
#     id: main_display
#     data_rate: 80MHz
