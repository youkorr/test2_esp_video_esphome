# OV5647 800x640 @ 50 FPS - Configuration Testée et Optimisée

## Source: testov5647 Working Configuration

Cette configuration 800x640 @ 50 FPS provient du repository [testov5647](https://github.com/youkorr/testov5647) où elle a été testée et validée avec une bonne qualité d'image.

## Avantages de 800x640 @ 50 FPS

### vs 1024x600 @ 30 FPS:
- ✅ **50% plus de FPS** (50 vs 30) = mouvement plus fluide
- ✅ **Qualité d'image testée et validée** dans testov5647
- ✅ **Meilleure stabilité AWB** (plus de frames pour convergence)
- ✅ **Moins de bande passante MIPI** = moins d'erreurs

### vs 640x480 @ 30 FPS (VGA):
- ✅ **67% plus de FPS** (50 vs 30) = mouvement ultra-fluide
- ✅ **Plus de pixels** (512000 vs 307200) = +66% résolution
- ✅ **Idéal pour écrans 800x480** (pas de redimensionnement)

## Configuration YAML

Pour utiliser 800x640 @ 50 FPS avec OV5647:

```yaml
mipi_dsi_cam:
  id: my_cam
  i2c_id: bsp_bus
  sensor_type: ov5647
  sensor_addr: 0x36
  resolution: "800x640"      # ← Résolution testov5647 @ 50 FPS
  pixel_format: RGB565
  framerate: 50              # ← 50 FPS (au lieu de 30)

lvgl_camera_display:
  id: camera_display
  camera_id: my_cam
  canvas_id: camera_canvas
  update_interval: 20ms      # ← 50 FPS = 20ms par frame
```

## Paramètres Techniques

### Registres Clés (de testov5647)

**Timing:**
- HTS (Horizontal Total Size): 1896 pixels
- VTS (Vertical Total Size): 984 lines
- Clock rate: 100 MHz (au lieu de 48 MHz pour VGA)
- MIPI CSI line rate: 400 Mbps

**Crop Window:**
- X start: 500 (décalage horizontal)
- Y start: 0
- X end: 2624
- Y end: 1954
- Crop size: 2124 × 1954

**Output:**
- Width: 800
- Height: 640
- Format: RAW8 (8-bit Bayer)

**AEC/AGC:**
- Auto-exposure: Activé (registers 0x3a08-0x3a1f)
- AE target: Configuration optimisée de testov5647

**ISP Settings (appliqués automatiquement):**
- Brightness: 60
- Contrast: 145
- Saturation: 135
- AWB: Auto-enabled

## Logs Attendus

Au démarrage du streaming, vous devriez voir:

```
[I][mipi_dsi_cam:712]: ✅ Using CUSTOM format: 800x640 RAW8 @ 50fps (OV5647 - testov5647 working config)
[I][mipi_dsi_cam:725]: ✅ Custom format applied successfully!
[I][mipi_dsi_cam:726]:    Sensor registers configured for native 800x640 @ 50 fps
[I][mipi_dsi_cam:1018]: ✓ AWB (Auto White Balance) enabled
[I][mipi_dsi_cam:1027]: ✓ Brightness boosted to 60 (from testov5647 working config)
[I][mipi_dsi_cam:1034]: ✓ Contrast set to 145 (from testov5647 working config)
[I][mipi_dsi_cam:1041]: ✓ Saturation set to 135 (from testov5647 working config)
```

## Comparaison des Résolutions OV5647

| Résolution | FPS | Clock | Pixels | MIPI Bandwidth | Qualité | Écran Idéal |
|-----------|-----|-------|--------|----------------|---------|-------------|
| **640x480** (VGA) | 30 | 48 MHz | 307K | 192 Mbps | Bonne | 640x480 |
| **800x640** ⭐ | 50 | 100 MHz | 512K | 400 Mbps | **Excellente** | 800x480 |
| **1024x600** | 30 | 72 MHz | 614K | 288 Mbps | Bonne | 1024x600 |

⭐ = Configuration recommandée (testée dans testov5647)

## Utilisation avec Écran 800x480

Pour un écran 800x480, cette résolution est **parfaite** car:
- **Largeur identique**: 800 pixels (pas de redimensionnement horizontal)
- **Hauteur crop**: 640 → 480 (crop vertical de 160 pixels = 25%, presque rien)
- **50 FPS fluide**: Mouvement ultra-fluide vs 30 FPS

Configuration LVGL pour écran 800x480:

```yaml
lvgl:
  displays:
    - display_id: main_display
      pages:
        - id: camera_page
          widgets:
            - canvas:
                id: camera_canvas
                width: 800        # Largeur parfaite
                height: 480       # Crop automatique de 640 → 480
                x: 0
                y: 0
```

## Utilisation avec Écran 1024x600

Pour un écran 1024x600:
- **Option 1**: Crop horizontal (800 → 1024 = upscale léger)
- **Option 2**: Garder 800x640 centré avec bandes noires latérales

```yaml
# Option 1: Crop/upscale (peut causer légère pixelisation)
- canvas:
    id: camera_canvas
    width: 1024
    height: 600
    x: 0
    y: 0

# Option 2: Centré avec bandes noires (image native, pas de distorsion)
- canvas:
    id: camera_canvas
    width: 800
    height: 600   # ou 640 pour garder aspect ratio
    x: 112        # Centré: (1024-800)/2
    y: 0
```

## Pourquoi 50 FPS au lieu de 30 FPS?

**Avantages du 50 FPS:**
1. **Mouvement fluide**: 66% plus de frames = mouvement beaucoup plus doux
2. **Meilleure AWB**: Plus de samples pour convergence rapide
3. **Latence réduite**: 20ms par frame vs 33ms @ 30 FPS
4. **Meilleure expérience**: UI/UX plus responsive

**Désavantages:**
- Légèrement plus de bande passante MIPI (mais < 1024x600 @ 30 FPS)
- Peut nécessiter `update_interval: 20ms` dans LVGL (au lieu de 33ms)

## Migration depuis 1024x600

Si vous utilisez actuellement 1024x600 @ 30 FPS et voulez migrer:

**Avant:**
```yaml
resolution: "1024x600"
framerate: 30
update_interval: 33ms   # ou 100ms
```

**Après:**
```yaml
resolution: "800x640"
framerate: 50
update_interval: 20ms   # 50 FPS = 20ms
```

**Résultat attendu:**
- ✅ Image plus fluide (50 vs 30 FPS)
- ✅ Qualité similaire ou meilleure (config testov5647)
- ✅ Blanc correctement blanc (AWB + testov5647 settings)
- ✅ Bon contraste (brightness/contrast/saturation optimisés)

## Troubleshooting

### Image trop sombre
```yaml
# Augmenter brightness
# (Par défaut déjà à 60 de testov5647)
```

### FPS instable
```yaml
# Augmenter update_interval LVGL
update_interval: 25ms   # Au lieu de 20ms
```

### Blanc toujours jaune
- AWB n'a pas convergé, attendre 5 secondes
- Vérifier logs: "✓ AWB enabled" doit apparaître
- Si nécessaire, désactiver AWB et utiliser température manuelle 6500K

## Références

- **Source**: https://github.com/youkorr/testov5647/blob/main/components/tab5_camera/tab5_camera.cpp
- **Configuration testée**: 800x640 @ 50 FPS RAW8
- **ISP Settings**: Brightness 60, Contrast 145, Saturation 135
- **Qualité**: Validée dans testov5647, image correcte
